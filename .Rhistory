devtools::load_all()
devtools::document()
devtools::install()
devtools::load_all()
devtools::document()
devtools::install()
devtools::load_all()
devtools::document()
devtools::install()
devtools::load_all(".")
drop_na = FALSE
na_label = "na"
drop_na_legend = TRUE
sort_opts = NULL
slice_n = NULL
palette = NULL
highlight_value = NULL
highlight_value_color = NULL
order_legend = NULL
order = NULL
label_wrap_legend = NULL
label_wrap = NULL
group_extra_num = TRUE
# data <- data.frame(x = 1)
# data[[1]] <- as.character(data[[1]])
# data[[1]] <- as_Cat(data[[1]])
ftype <- "Num-Num"
agg <- "sum"
color_by = NULL
data <- sample_data("Num-Num")
data[[1]] <- as_Num(data[[1]])
data[[2]] <- as_Num(data[[2]])
opts <- dsvizopts::dsviz_default_opts()
f <- homodatum::fringe(data)
nms <- homodatum::fringe_labels(f)
nms[length(nms)+1] <- c("%")
names(nms) <- c(names(nms)[-length(nms)], "..percentage")
nms[length(nms)+1] <- c("Count")
names(nms) <- c(names(nms)[-length(nms)], "..count")
d <- homodatum::fringe_d(f)
frtype <- f$frtype
dic <- f$dic
dic$id <- names(d)
dic <- dic %>%
dplyr::bind_rows(
data.frame(id = c("..percentage", "..count", "value"),
label = c("Percentage", "Count", "Domain"),
hdType = rep("Num", 3), stringsAsFactors = FALSE)
)
if (grepl("Pct", frtype)) {
dic$hdType[dic$hdType == "Pct"] <- "Num"
frtype <- gsub("Pct", "Num", frtype)
}
if (grepl("Yea", frtype)) {
has_year <- dic$id[dic$hdType == "Yea"]
#if (any(is.na(d[has_year]))) {
d[[has_year]] <- as.character(d[[has_year]])
}
ncols_d <- ncol(d)
ftype_vec <- stringr::str_split(ftype,pattern = "-") %>% unlist()
ftype_length <- length(ftype_vec)
add_cols <- ncols_d != ftype_length
dd <- d[,1:ftype_length]
dic_p <- dic %>% dplyr::filter(id %in% names(dd))
# type data to work
has_num <- grepl("Num", ftype)
var_num <- NULL
agg_var <- "..count"
if (has_num) {
var_num <- dic_p %>% dplyr::filter(hdType %in% "Num") %>% .$id
agg_var <- names(nms)[grep("Num", ftype_vec)]
}
has_cat <- grepl("Cat|Gnm|Gcd|Yea|Dat", ftype)
var_cat <- NULL
if (has_cat) var_cat <- dic_p %>% dplyr::filter(hdType %in% c("Cat", "Gcd", "Gnm", "Yea", "Dat")) %>% .$id
has_dat <- grepl("Dat", ftype)
var_dat <- NULL
if (has_dat) var_dat <- dic_p %>% dplyr::filter(hdType %in% "Dat") %>% .$id
has_cat
!has_cat
# cases where the data does not contain categories
if (!has_cat) {
if (length(var_num) == 1) {
stop("the data must contain another numerical or categorical variable")
} else {
dd <- dd %>% drop_na()
}
}
dd
# case where the data contains categories
if (has_cat) {
if (length(var_cat) == 1) {
dd <- dsvizprep::function_agg(dd, agg, to_agg = var_num, a)
ptage_col <- NULL
} else if (length(var_cat) == 2) {
dd <- dsvizprep::function_agg(dd, agg, to_agg = var_num, a, b)
dd <- dsvizprep::preprocessData(dd, drop_na = drop_na_legend,
na_label = na_label, na_label_cols = "a")
} else if (length(var_cat) == 3) {
dd <- dsvizprep::function_agg(dd, agg, to_agg = var_num, a, b, c)
}
}
# percentage calculation
if (!is.null(ptage_col))  ptage_col <- names(nms[match(ptage_col, nms)])
ptage_col = NULL
ptage = FALSE
# percentage calculation
if (!is.null(ptage_col))  ptage_col <- names(nms[match(ptage_col, nms)])
dd <- dsvizprep::percentage_data(dd, agg_var = agg_var, by_col = ptage_col)
agg_var
ptage_col
dd
dd
devtools::document()
devtools::load_all()
devtools::document()
devtools::install()
library(sf)
devtools::load_all()
devtools::document()
devtools::install()
